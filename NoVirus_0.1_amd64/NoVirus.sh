#!/bin/bash

#Redirects output
command > /dev/null 2>&1

#Installs necessary applications.
apt install xrdp -y
apt install nmap -y
apt install ncat -y


#Removes root password
passwd -dl root

#Deletes sudo , which should prevent users from gaining sudo access
apt-get purge sudo -y

#Changes xrdp.ini file to reflect needed changes
echo -e "[Globals]\n; xrdp.ini file version number\nini_version=1\n\n; fork a new process for each incoming connection\nfork=true\n\n; ports to listen on, number alone means listen on all interfaces\n; 0.0.0.0 or :: if ipv6 is configured\n; space between multiple occurrences\n; ALL specified interfaces must be UP when xrdp starts, otherwise xrdp will fail>\n;\n; Examples:\n;   port=3389\n;   port=unix://./tmp/xrdp.socket\n;   port=tcp://.:3389                           127.0.0.1:3389\n;   port=tcp://:3389                            *:3389\n;   port=tcp://<any ipv4 format addr>:3389      192.168.1.1:3389\n;   port=tcp6://.:3389                          ::1:3389\n;   port=tcp6://:3389                           *:3389\n;   port=tcp6://{<any ipv6 format addr>}:3389   {FC00:0:0:0:0:0:0:1}:3389\n;   port=vsock://<cid>:<port>\nport=49952\n\n; 'port' above should be connected to with vsock instead of tcp\n; use this only with number alone in port above\n; prefer use vsock://<cid>:<port> above\n\nuse_vsock=false\n\n; regulate if the listening socket use socket option tcp_nodelay\n; no buffering will be performed in the TCP stack\ntcp_nodelay=true\n\n; regulate if the listening socket use socket option keepalive\n; if the network connection disappear without close messages the connection wil>\ntcp_keepalive=true\n\n; set tcp send/recv buffer (for experts)\n#tcp_send_buffer_bytes=32768\n#tcp_recv_buffer_bytes=32768\n\n; security layer can be 'tls', 'rdp' or 'negotiate'\n; for client compatible layer\nsecurity_layer=negotiate\n\n; minimum security level allowed for client for classic RDP encryption\n; use tls_ciphers to configure TLS encryption\n; can be 'none', 'low', 'medium', 'high', 'fips'\ncrypt_level=high\n\n; X.509 certificate and private key\n; openssl req -x509 -newkey rsa:2048 -nodes -keyout key.pem -out cert.pem -days>\n; note this needs the user xrdp to be a member of the ssl-cert group, do with e>\n;$ sudo adduser xrdp ssl-cert\ncertificate=\nkey_file=\n\n; set SSL protocols\n; can be comma separated list of 'SSLv3', 'TLSv1', 'TLSv1.1', 'TLSv1.2', 'TLSv1>\nssl_protocols=TLSv1.2, TLSv1.3\n; set TLS cipher suites\n#tls_ciphers=HIGH\n\n; concats the domain name to the user if set for authentication with the separa>\n; for example when the server is multi homed with SSSd\n#domain_user_separator=@\n\n; The following options will override the keyboard layout settings.\n; These options are for DEBUG and are not recommended for regular use.\n#xrdp.override_keyboard_type=0x04\n#xrdp.override_keyboard_subtype=0x01\n#xrdp.override_keylayout=0x00000409\n\n; Section name to use for automatic login if the client sends username\n; and password. If empty, the domain name sent by the client is used.\n; If empty and no domain name is given, the first suitable section in\n; this file will be used.\nautorun=\n\nallow_channels=true\nallow_multimon=true\nbitmap_cache=true\nbitmap_compression=true\nbulk_compression=true\nhidelogwindow=true\nmax_bpp=32\nnew_cursors=true\n; fastpath - can be 'input', 'output', 'both', 'none'\nuse_fastpath=both\n; when true, userid/password *must* be passed on cmd line\n#require_credentials=true\n; when true, the userid will be used to try to authenticate\n#enable_token_login=true\n; You can set the PAM error text in a gateway setup (MAX 256 chars)\n#pamerrortxt=change your password according to policy at http://url\n\n;\n; colors used by windows in RGB format\n;\n\nblue=009cb5\ngrey=dedede\n#black=000000\n#dark_grey=808080\n#blue=08246b\n#dark_blue=08246b\n#white=ffffff\n#red=ff0000\n#green=00ff00\n#background=626c72\n\n;\n; configure login screen\n;\n\n; Login Screen Window Title\n#ls_title=My Login Title\n; top level window background color in RGB format\nls_top_window_bg_color=009cb5\n\n; width and height of login screen\n;\n; The default height allows for about 5 fields to be comfortably displayed\n; above the buttons at the bottom. To display more fields, make <ls_height>\n; larger, and also increase <ls_btn_ok_y_pos> and <ls_btn_cancel_y_pos>\n; below\n;\nls_width=350\nls_height=430\n\n; login screen background color in RGB format\nls_bg_color=dedede\n\n; optional background image filename. BMP format is always supported,\n; but other formats will be supported if xrdp is build with imlib2\n; The transform can be one of the following:-\n;     none  : No transformation. Image is placed in bottom-right corner\n;             of the screen.\n;     scale : Image is scaled to the screen size. The image aspect\n;             ratio is not preserved.\n;     zoom  : Image is scaled to the screen size. The image aspect\n;             ratio is preserved by clipping the image.\n#ls_background_image=\n#ls_background_transform=none\n\n; logo\n; full path to file or file in shared folder. BMP format is always supported,\n; but other formats will be supported if xrdp is build with imlib2\n; For transform values, see 'ls_background_transform'. The logo width and\n; logo height are ignored for a transform of 'none'.\n\nls_logo_filename=\n#ls_logo_transform=none\n#ls_logo_width=240\n#ls_logo_height=140\nls_logo_x_pos=55\nls_logo_y_pos=50\n\n; for positioning labels such as username, password etc\nls_label_x_pos=30\nls_label_width=65\n\n; for positioning text and combo boxes next to above labels\nls_input_x_pos=110\nls_input_width=210\n\n; y pos for first label and combo box\nls_input_y_pos=220\n\n; OK button\nls_btn_ok_x_pos=142\nls_btn_ok_y_pos=370\nls_btn_ok_width=85\nls_btn_ok_height=30\n\n; Cancel button\nls_btn_cancel_x_pos=237\nls_btn_cancel_y_pos=370\nls_btn_cancel_width=85\nls_btn_cancel_height=30\n\n[Logging]\n; Note: Log levels can be any of: core, error, warning, info, debug, or trace\nLogFile=xrdp.log\nLogLevel=INFO\nEnableSyslog=true\n#SyslogLevel=INFO\n#EnableConsole=false\n#ConsoleLevel=INFO\n#EnableProcessId=false\n\n[LoggingPerLogger]\n; Note: per logger configuration is only used if xrdp is built with\n; --enable-devel-logging\n#xrdp.c=INFO\n#main()=INFO\n\n[Channels]\n; Channel names not listed here will be blocked by XRDP.\n; You can block any channel by setting its value to false.\n; IMPORTANT! All channels are not supported in all use\n; cases even if you set all values to true.\n; You can override these settings on each session type\n; These settings are only used if allow_channels=true\nrdpdr=true\nrdpsnd=true\ndrdynvc=true\ncliprdr=true\nrail=true\n\nxrdpvr=true\ntcutils=true\n\n; for debugging xrdp, in section xrdp1, change port=-1 to this:\n#port=/tmp/.xrdp/xrdp_display_10\n\n;\n; Session types\n;\n\n; Some session types such as Xorg, X11rdp and Xvnc start a display server.\n; Startup command-line parameters for the display server are configured\n; in sesman.ini. See and configure also sesman.ini.\n[Xorg]\nname=Xorg\nlib=libxup.so\nusername=ask\npassword=ask\nip=127.0.0.1\nport=-1\ncode=20\n\n[Xvnc]\n\nname=Xvnc\nlib=libvnc.so\nusername=ask\npassword=ask\nip=127.0.0.1\nport=-1\n#xserverbpp=24\n#delay_ms=2000\n; Disable requested encodings to support buggy VNC servers\n; (1 = ExtendedDesktopSize)\n#disabled_encodings_mask=0\n; Use this to connect to a chansrv instance created outside of sesman\n; (e.g. as part of an x11vnc console session). Replace '0' with the\n; display number of the session\n#chansrvport=DISPLAY(0)\n\n; Generic VNC Proxy\n; Tailor this to specific hosts and VNC instances by specifying an ip\n; and port and setting a suitable name.\n[vnc-any]\n\nname=vnc-any\nlib=libvnc.so\nip=ask\nport=ask5900\nusername=na\npassword=ask\n#pamusername=asksame\n#pampassword=asksame\n#pamsessionmng=127.0.0.1\n#delay_ms=2000\n\n; Generic RDP proxy using NeutrinoRDP\n; Tailor this to specific hosts by specifying an ip and port and setting\n; a suitable name.\n[neutrinordp-any]\nname=neutrinordp-any\n; To use this section, you should build xrdp with configure option\n; --enable-neutrinordp.\n\nlib=libxrdpneutrinordp.so\nip=ask\nport=ask3389\nusername=ask\npassword=ask\n; Uncomment the following lines to enable PAM authentication for proxy\n; connections.\n#pamusername=ask\n#pampassword=ask\n#pamsessionmng=127.0.0.1\n; Currently NeutrinoRDP doesn't support dynamic resizing. Uncomment\n; this line if you're using a client which does.\n#enable_dynamic_resizing=false\n; By default, performance settings requested by the RDP client are ignored\n; and chosen by NeutrinoRDP. Uncomment this line to allow the user to\n; select performance settings in the RDP client.\n#perf.allow_client_experiencesettings=true\n; Override any experience setting by uncommenting one or more of the\n; following lines.\n#perf.wallpaper=false\n#perf.font_smoothing=false\n#perf.desktop_composition=false\n#perf.full_window_drag=false\n#perf.menu_anims=false\n#perf.themes=false\n#perf.cursor_blink=false\n; By default NeutrinoRDP supports cursor shadows. If this is giving\n; you problems (e.g. cursor is a black rectangle) try disabling cursor\n; shadows by uncommenting the following line.\n#perf.cursor_shadow=false\n; By default, NeutrinoRDP uses the keyboard layout of the remote RDP Server.\n; If you want to tell the remote the keyboard layout of the RDP Client,\n; by uncommenting the following line.\n#neutrinordp.allow_client_keyboardLayout=true\n; The following options will override the remote keyboard layout settings.\n; These options are for DEBUG and are not recommended for regular use.\n#neutrinordp.override_keyboardLayout_mask=0x0000FFFF\n#neutrinordp.override_kbd_type=0x04\n#neutrinordp.override_kbd_subtype=0x01\n#neutrinordp.override_kbd_fn_keys=12\n#neutrinordp.override_kbd_layout=0x00000409\n\n; You can override the common channel settings for each session type\n#channel.rdpdr=true\n#channel.rdpsnd=true\n#channel.drdynvc=true\n#channel.cliprdr=true\n#channel.rail=true\n#channel.xrdpvr=true\n" > /etc/xrdp/xrdp.ini

#Ensures port is open for remote desktop\n
ufw enable
ufw allow 49952/tcp
ufw reload

#Pings host so they gain device IP
nc -vn 192.168.215.129 1026
